# ğŸ¨ SYSTEM ARCHITECTURE & FLOW DIAGRAMS

Visualisasi lengkap sistem backend ticketing dengan WhatsApp OTP.

---

## ğŸ“ SYSTEM ARCHITECTURE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND (Browser)                       â”‚
â”‚  D:\web_ticketing\forgot-password.html + forgot-password.js    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  Step 1: Input Nama & HP â†’ Fetch POST /request-otp              â”‚
â”‚  Step 2: Input OTP â†’ Fetch POST /verify-otp                     â”‚
â”‚  Step 3: Input Password â†’ Fetch POST /reset-password            â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ HTTPS/Fetch API
                           â”‚ (CORS enabled)
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BACKEND (Express Server)                       â”‚
â”‚            D:\ticketing-backend\server.js (Port 5000)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€ ROUTES LAYER                                                 â”‚
â”‚  â”‚  /api/forgot-password/request-otp                             â”‚
â”‚  â”‚  /api/forgot-password/verify-otp                              â”‚
â”‚  â”‚  /api/forgot-password/reset-password                          â”‚
â”‚  â”‚  /api/forgot-password/bot-status                              â”‚
â”‚  â”‚                                                                â”‚
â”‚  â””â”€â†’ CONTROLLER LAYER                                            â”‚
â”‚      forgotPasswordController.js                                  â”‚
â”‚      â€¢ requestOTP()                                              â”‚
â”‚      â€¢ verifyOTPCode()                                           â”‚
â”‚      â€¢ resetPassword()                                           â”‚
â”‚      â€¢ checkBotStatus()                                          â”‚
â”‚      â”‚                                                            â”‚
â”‚      â””â”€â†’ SERVICES LAYER                                          â”‚
â”‚          â”œâ”€ otpService.js                                        â”‚
â”‚          â”‚  â€¢ generateOTP()                                      â”‚
â”‚          â”‚  â€¢ saveOTP()                                          â”‚
â”‚          â”‚  â€¢ verifyOTP()                                        â”‚
â”‚          â”‚  â€¢ deleteOTP()                                        â”‚
â”‚          â”‚                                                        â”‚
â”‚          â”œâ”€ whatsappService.js                                   â”‚
â”‚          â”‚  â€¢ initWhatsAppClient()                               â”‚
â”‚          â”‚  â€¢ sendOTPMessage()                                   â”‚
â”‚          â”‚  â€¢ getClientStatus()                                  â”‚
â”‚          â”‚                                                        â”‚
â”‚          â””â”€ userService.js                                       â”‚
â”‚             â€¢ findUserByNamaAndPhone()                           â”‚
â”‚             â€¢ updateUserPassword()                              â”‚
â”‚             â”‚                                                     â”‚
â”‚             â””â”€â†’ DATA LAYER                                       â”‚
â”‚                 data/data.json                                   â”‚
â”‚                 â€¢ users[]                                        â”‚
â”‚                 â€¢ otps[]                                         â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ Puppeteer Browser Automation
                        â”‚
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              WHATSAPP WEB.JS (Browser Simulation)                â”‚
â”‚             .wwebjs_auth/ (Session Storage)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  Puppeteer â†’ Open WhatsApp Web â†’ Send Message                    â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”˜
                        â”‚                                       â”‚
                        â”‚ WhatsApp Protocol                     â”‚
                        â†“                                       â†“
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚ WhatsApp â”‚                           â”‚ User's HPâ”‚
                  â”‚  Server  â”‚                           â”‚WhatsApp  â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†‘                                       â†“
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              Message Routing
```

---

## ğŸ”„ REQUEST/RESPONSE FLOW

### FLOW 1: Request OTP (Step 1)

```
â”Œâ”€ FRONTEND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                        â”‚
â”‚ User input:                                            â”‚
â”‚  â€¢ Nama: "John Doe"                                   â”‚
â”‚  â€¢ Nomor HP: "6281234567890"                          â”‚
â”‚                                                        â”‚
â”‚ Click: "Minta Kode OTP"                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ fetch('POST /api/forgot-password/request-otp', {
                       â”‚   body: {
                       â”‚     nama: "John Doe",
                       â”‚     noHp: "6281234567890"
                       â”‚   }
                       â”‚ })
                       â†“
â”Œâ”€ BACKEND (Controller) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                        â”‚
â”‚ 1. Validasi input (nama & noHp)                      â”‚
â”‚ 2. Find user di database                             â”‚
â”‚ 3. Call otpService.generateOTP()                     â”‚
â”‚ 4. Call otpService.saveOTP()                         â”‚
â”‚ 5. Call whatsappService.sendOTPMessage()             â”‚
â”‚ 6. Return response                                    â”‚
â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ Response:
                       â”‚ {
                       â”‚   success: true,
                       â”‚   message: "OTP dikirim ke WhatsApp",
                       â”‚   phoneNumber: "6281234567890",
                       â”‚   testOTP: "123456" (if bot not ready)
                       â”‚ }
                       â†“
â”Œâ”€ FRONTEND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                        â”‚
â”‚ 1. Check response.success                            â”‚
â”‚ 2. Show success message                              â”‚
â”‚ 3. Go to Step 2                                      â”‚
â”‚ 4. Start 15-minute timer                             â”‚
â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### FLOW 2: Verify OTP (Step 2)

```
â”Œâ”€ FRONTEND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                        â”‚
â”‚ User input:                                            â”‚
â”‚  â€¢ OTP: "123456"                                      â”‚
â”‚                                                        â”‚
â”‚ Click: "Verifikasi OTP"                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ fetch('POST /api/forgot-password/verify-otp', {
                       â”‚   body: {
                       â”‚     noHp: "6281234567890",
                       â”‚     otp: "123456"
                       â”‚   }
                       â”‚ })
                       â†“
â”Œâ”€ BACKEND (Controller) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                        â”‚
â”‚ 1. Validasi input (noHp & otp)                       â”‚
â”‚ 2. Call otpService.verifyOTP()                       â”‚
â”‚ 3. Check OTP validity:                               â”‚
â”‚    â”œâ”€ OTP match? âœ“                                   â”‚
â”‚    â”œâ”€ Not expired? âœ“                                 â”‚
â”‚    â”œâ”€ Attempts < 3? âœ“                                â”‚
â”‚ 4. Mark OTP as verified                              â”‚
â”‚ 5. Return response                                    â”‚
â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ Response:
                       â”‚ {
                       â”‚   success: true,
                       â”‚   message: "OTP verified",
                       â”‚   data: { otpId: 1704067200000 }
                       â”‚ }
                       â†“
â”Œâ”€ FRONTEND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                        â”‚
â”‚ 1. Check response.success                            â”‚
â”‚ 2. Save otpId from response                          â”‚
â”‚ 3. Show success message                              â”‚
â”‚ 4. Go to Step 3                                      â”‚
â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### FLOW 3: Reset Password (Step 3)

```
â”Œâ”€ FRONTEND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                        â”‚
â”‚ User input:                                            â”‚
â”‚  â€¢ New Password: "newPass123"                         â”‚
â”‚  â€¢ Confirm Password: "newPass123"                     â”‚
â”‚                                                        â”‚
â”‚ Click: "Ubah Sandi"                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ fetch('POST /api/forgot-password/reset-password', {
                       â”‚   body: {
                       â”‚     noHp: "6281234567890",
                       â”‚     otp: "123456",
                       â”‚     newPassword: "newPass123",
                       â”‚     confirmPassword: "newPass123"
                       â”‚   }
                       â”‚ })
                       â†“
â”Œâ”€ BACKEND (Controller) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                        â”‚
â”‚ 1. Validasi input                                    â”‚
â”‚ 2. Check password match                              â”‚
â”‚ 3. Check password strength (min 6 char)              â”‚
â”‚ 4. Verify OTP status (is verified?)                  â”‚
â”‚ 5. Find user by phone                                â”‚
â”‚ 6. Call userService.updateUserPassword()             â”‚
â”‚ 7. Call otpService.deleteOTP()                       â”‚
â”‚ 8. Return response                                    â”‚
â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ Response:
                       â”‚ {
                       â”‚   success: true,
                       â”‚   message: "Password updated, please login"
                       â”‚ }
                       â†“
â”Œâ”€ FRONTEND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                        â”‚
â”‚ 1. Check response.success                            â”‚
â”‚ 2. Show success message                              â”‚
â”‚ 3. Clear all form data                               â”‚
â”‚ 4. Redirect to login page after 2 seconds            â”‚
â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š DATA FLOW DIAGRAM

```
USER DATA REQUEST
        â”‚
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend Form          â”‚
â”‚  (forgot-password.html)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ User input
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Validation             â”‚
â”‚  (Client-side)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Valid data
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Fetch API              â”‚
â”‚  (JSON payload)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ HTTP POST
           â”‚ CORS enabled
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Express Routes                 â”‚
â”‚  (forgotPasswordRoutes.js)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Route match
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Controllers                    â”‚
â”‚  (forgotPasswordController.js)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â†’ Validation
           â”‚   errorDiv.textContent
           â”‚
           â”œâ”€â†’ Database operation
           â”‚   data.json read/write
           â”‚
           â”œâ”€â†’ WhatsApp operation
           â”‚   Puppeteer â†’ WhatsApp API
           â”‚
           â””â”€â†’ Response generation
               JSON response
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   HTTP Response                  â”‚
â”‚  (JSON)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ JSON data
           â”‚ CORS headers
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend Handler       â”‚
â”‚  (forgot-password.js)    â”‚
â”‚                          â”‚
â”‚  .then(res => res.json())â”‚
â”‚  .then(data => handle)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â†’ Check success flag
           â”‚
           â”œâ”€â†’ Show error/success
           â”‚   DOM update
           â”‚
           â””â”€â†’ Next step or redirect
```

---

## ğŸ” DATA STORAGE HIERARCHY

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        data/data.json (File)           â”‚
â”‚   â”œâ”€ LOCAL FILE SYSTEM                 â”‚
â”‚   â”‚  â””â”€ D:\ticketing-backend\data\     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”œâ”€â†’ users[]
                  â”‚   â”œâ”€ id
                  â”‚   â”œâ”€ nama
                  â”‚   â”œâ”€ email
                  â”‚   â”œâ”€ noHp
                  â”‚   â””â”€ password
                  â”‚
                  â””â”€â†’ otps[]
                      â”œâ”€ id
                      â”œâ”€ phoneNumber
                      â”œâ”€ otp
                      â”œâ”€ createdAt
                      â”œâ”€ expiresAt
                      â”œâ”€ attempts
                      â””â”€ verified
```

---

## â±ï¸ OTP LIFECYCLE

```
â”Œâ”€ TIME 0 (OTP REQUEST) â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                â”‚
â”‚  User request OTP              â”‚
â”‚  â”‚                              â”‚
â”‚  â”œâ”€â†’ OTP generated (6 digit)   â”‚
â”‚  â”œâ”€â†’ OTP saved to data.json    â”‚
â”‚  â”œâ”€â†’ expiresAt = now + 15 min  â”‚
â”‚  â””â”€â†’ Send to WhatsApp          â”‚
â”‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

         [WAITING PERIOD]
         [~15 minutes]

â”Œâ”€ TIME 0-15 MIN (OTP ACTIVE) â”€â”€â”
â”‚                                â”‚
â”‚  User has OTP in WhatsApp      â”‚
â”‚  User input OTP ke form        â”‚
â”‚  â”‚                              â”‚
â”‚  â”œâ”€â†’ verifyOTP() called        â”‚
â”‚  â”œâ”€â†’ Check OTP match âœ“         â”‚
â”‚  â”œâ”€â†’ Check not expired âœ“       â”‚
â”‚  â”œâ”€â†’ Check attempts < 3 âœ“      â”‚
â”‚  â”œâ”€â†’ Mark verified = true      â”‚
â”‚  â””â”€â†’ Ready for password reset  â”‚
â”‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ TIME 15+ MIN (OTP EXPIRED) â”€â”€â”
â”‚                                â”‚
â”‚  OTP auto-expire               â”‚
â”‚  â”‚                              â”‚
â”‚  â”œâ”€â†’ cleanExpiredOTPs()        â”‚
â”‚  â”œâ”€â†’ Delete dari data.json     â”‚
â”‚  â””â”€â†’ User must request new OTP â”‚
â”‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ AFTER PASSWORD RESET â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                â”‚
â”‚  Password reset success        â”‚
â”‚  â”‚                              â”‚
â”‚  â”œâ”€â†’ OTP deleted               â”‚
â”‚  â”œâ”€â†’ User can login now        â”‚
â”‚  â””â”€â†’ System ready for next     â”‚
â”‚      forgot password request   â”‚
â”‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”€ ERROR HANDLING FLOW

```
â”Œâ”€ REQUEST COMES IN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     â”‚
â”‚ POST /forgot-password/request-otp   â”‚
â”‚ body: { nama, noHp }                â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
      â”Œâ”€ VALIDATION â”€â”€â”
      â”‚                â”‚
      â”œâ”€ nama empty? â”€â”€â†’ ERROR 400: "Nama harus diisi"
      â”‚   noHp empty? â”€â†’ ERROR 400: "NoHp harus diisi"
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜
                    â”‚
                    â†“
         â”Œâ”€ USER CHECK â”€â”€â”
         â”‚                â”‚
         â””â”€ User exist? â”€â”€â†’ ERROR 404: "User tidak ditemukan"
                â”‚
                â†“
         â”Œâ”€ OTP CHECK â”€â”€â”€â”
         â”‚                â”‚
         â””â”€ Active OTP? â”€â†’ ERROR 400: "Sudah ada OTP aktif"
                â”‚
                â†“
         â”Œâ”€ WHATSAPP CHECK â”
         â”‚                  â”‚
         â”œâ”€ Bot ready? â”€â”€â”€â”€â†’ OK: Send msg, return response
         â”‚                   dengan testOTP
         â”‚
         â””â”€ Bot not ready â”€â†’ OK: Generate OTP, return
                              dengan testOTP (untuk testing)
                â”‚
                â†“
         â”Œâ”€ SUCCESS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                            â”‚
         â”‚ Return 200: {              â”‚
         â”‚   success: true,           â”‚
         â”‚   message: "OTP sent",     â”‚
         â”‚   phoneNumber: "628123..." â”‚
         â”‚   testOTP: "123456"        â”‚
         â”‚ }                          â”‚
         â”‚                            â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“± WHATSAPP BOT STATE MACHINE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UNINITIALIZED  â”‚  â† Server startup
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ initWhatsAppClient()
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   INITIALIZING  â”‚  â† Puppeteer starting
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Opening WhatsApp Web
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WAITING FOR QR â”‚  â† Display QR code
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ User scans QR code
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚AUTHENTICATING   â”‚  â† Phone scanning
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Authentication success
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AUTHENTICATED  â”‚  â† Session saved
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Initialize complete
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     READY       â”‚  â† Can send messages
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ†’ Can send OTP
         â”‚
         â”œâ†’ Can receive messages
         â”‚
         â”œâ†’ Disconnect from HP
         â”‚
         â””â†’ Go to DISCONNECTED state
              â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚DISCONNECTED  â”‚  â† Need re-auth
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ SUMMARY DIAGRAMS

### System Components:
```
FRONTEND              BACKEND                  EXTERNAL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â””â”€ HTML              â”œâ”€ Express Server         â”œâ”€ WhatsApp
â””â”€ JavaScript        â”œâ”€ Controllers           â”œâ”€ Puppeteer
â””â”€ Fetch API         â”œâ”€ Services              â””â”€ Node.js
â””â”€ localStorage      â”œâ”€ Routes
                     â”œâ”€ JSON Database
                     â””â”€ WhatsApp Client
```

### Data Flow:
```
Browser â†’ Express â†’ Controllers â†’ Services â†’ Database/WhatsApp
  â†‘                                              â†“
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           (HTTP Response with JSON)
```

### Security Layers:
```
Browser                Backend                Database
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â””â”€ Input validation   â”œâ”€ Input validation    â”œâ”€ File access
â””â”€ Client-side checks â”œâ”€ Server validation   â”œâ”€ Data validation
â””â”€ localStorage       â”œâ”€ Error handling      â””â”€ Type checking
â””â”€ HTTPS ready        â”œâ”€ CORS
                      â””â”€ Rate limiting ready
```

---

**This diagram documentation helps understand the system architecture comprehensively!**
